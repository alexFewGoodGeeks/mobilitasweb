define(["require","exports","tslib","react","modules/core/i18n","modules/clean/viewer","spectrum/typeahead","dig-components/icons/src","dig-components/typography","dig-components/icons","dig-components/avatar","modules/clean/api_v2/default_team_client","modules/clean/react/css","modules/clean/teams/admin/widgets/groups/create_group_modal"],(function(e,t,n,r,o,a,u,i,s,c,l,g,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r);var m={group_name:o.intl.formatMessage({id:"J54snd",defaultMessage:"Create new group"}),group_id:"",group_management_type:{".tag":"other"}},f=function(e){var t=e.toUpperCase().split(" ");return""+t[0][0]+(t.length>1?t[t.length-1][0]:"")},_=function(e){var t=e.token,n=e.query;return t===m?r.default.createElement(r.default.Fragment,null,r.default.createElement(c.UIIcon,{className:"group-suggestion-icon",src:i.AddCircleFill}),r.default.createElement(s.Text,null,n?o.intl.formatMessage({id:"j/dwP3",defaultMessage:'Create "{group_name}"'},{group_name:n}):t.group_name)):r.default.createElement(r.default.Fragment,null,r.default.createElement("div",{className:"group-suggestion-icon"},r.default.createElement(l.Avatar,{size:"small",hasNoOutline:!0,backgroundColor:l.avatarColorForUserIdentifier(f(t.group_name))},f(t.group_name))),r.default.createElement("div",{className:"group-suggestion-info"},r.default.createElement(s.Text,null,t.group_name),r.default.createElement(s.Text,{size:"small",color:"faint"},o.intl.formatMessage({id:"XMHn5C",defaultMessage:"{count, plural, one{# member} other{# members}}"},{count:t.member_count||0}))))};t.fetchGroups=function(e){return void 0===e&&(e=!0),n.__awaiter(void 0,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,new g.DefaultTeamApiV2Client(a.Viewer.get_viewer().work_user).ns("team").rpc("groups/list",{limit:1e3},{}).then((function(t){if(!e)return t.groups;var n=t.groups.reduce((function(e,t){return"system_managed"===t.group_management_type[".tag"]&&(t.member_count||0)>=(e.member_count||0)?t:e})).group_id;return t.groups.filter((function(e){return e.group_id!==n}))}))];case 1:return[2,t.sent()]}}))}))},t.groupExists=function(e,t){return e.some((function(e){return e.group_name.toLocaleLowerCase()===t.toLocaleLowerCase()}))},t.GroupsTypeahead=d.requireCssWithComponent((function(e){var a=e.selected,i=e.groups,s=void 0===i?[]:i,c=e.onChange,l=e.onCreate,g=e.onInputChange,d=e.handleCreateModal,f=r.useState(!1),v=f[0],h=f[1],C=r.useState(),y=C[0],w=C[1],E=r.useState([]),b=E[0],x=E[1];r.useEffect((function(){return null==d?void 0:d(v)}),[v]),r.useEffect((function(){return null==g?void 0:g(y)}),[y]),r.useEffect((function(){return M()}),[a,s]);var M=function(e){w(e),x(n.__spreadArrays([m],s.reduce((function(t,n){return a.find((function(e){return e.group_id===n.group_id}))?t:(e?n.group_name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1&&t.push(n):t.push(n),t)}),[]).sort((function(e,t){return e.group_name.localeCompare(t.group_name)}))))};return r.default.createElement(u.Typeahead,{height:200,listItemHeight:48,className:"groups-typeahead",inputProps:{placeholder:a.length?void 0:o.intl.formatMessage({id:"Hh48DQ",defaultMessage:"Select or create group"})},onChange:M,onRemoveToken:function(e){return c(a.filter((function(t){return t.group_id!==e.group_id})))},onSelect:function(e,r,o){if(e===m){if(!o)return void h(!0);t.groupExists(s,o)||p.createGroup(o).then((function(e){var t={group_id:e.group_id,group_name:e.group_name,group_external_id:e.group_external_id,group_management_type:e.group_management_type,member_count:e.member_count};null==l||l(t)})).catch((function(e){return(function(e){c(n.__spreadArrays(a,[{group_name:e,group_id:e+"-invalid",group_management_type:{".tag":"other"},variant:"error"}])),w(void 0)})(o)})),w(void 0)}var u=s.find((function(t){return t.group_id===e.group_id}));u&&c(n.__spreadArrays(a,[u]))},renderSuggestion:function(e){return r.default.createElement(_,{token:e,query:y})},renderTokenContent:function(e){return r.default.createElement(r.default.Fragment,null,e.group_name)},suggestions:b,tokens:a.map((function(e){return{key:e.group_id,variant:e.variant||"default",content:e}}))})}),["/static/css/spectrum/index.web-vfl6Z83yw.css","/static/css/dig-components/index.web-vfliFNMrU.css","/static/css/teams/admin/widgets/groups/groups_typeahead-vfli8OYdu.css"])}));
//# sourceMappingURL=groups_typeahead.min.js-vflKzqmSF.map